<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDAS3.0</title>
    <link rel="icon" href="/static/assets/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/static/assets/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Global styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            scrollbar-width: thin; /* For Firefox */
        }

        /* Webkit (Chrome, Safari, newer versions of Opera) scrollbar styling */
        *::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        *::-webkit-scrollbar-track {
            background: transparent;
        }

        *::-webkit-scrollbar-thumb {
            background-color: var(--text-muted);
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        *::-webkit-scrollbar-thumb:hover {
            background-color: var(--text-secondary);
        }

        /* Dark theme scrollbar */
        [data-theme="dark"] *::-webkit-scrollbar-thumb {
            background-color: var(--text-secondary);
        }

        [data-theme="dark"] *::-webkit-scrollbar-thumb:hover {
            background-color: var(--text-primary);
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow: hidden;
        }
        
        :root {
            /* Light theme variables */
            --bg-primary: #f9fafb;
            --bg-secondary: #f0f0f0;
            --bg-tertiary: #e5e5e5;
            --bg-accent: #555555;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --text-muted: #6b7280;
            --text-accent: #333333;
            --text-on-accent: #ffffff;
            --border-color: #e5e7eb;
            --message-user-bg: #333333;
            --message-user-text: #ffffff;
            --message-assistant-bg: #ffffff;
            --message-assistant-text: #111827;
            --message-system-bg: #f3f4f6;
            --message-system-text: #4b5563;
            --code-bg: #f3f4f6;
            --thinking-bg: #f3f4f6;
            --thinking-border: #666666;
            --button-hover: #555555;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        
        /* Dark theme variables */
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --bg-tertiary: #3a3a3a;
            --bg-accent: #ffd700; /* Changed to gold for better visibility */
            --text-primary: #ffffff; /* Brighter white for better readability */
            --text-secondary: #e5e7eb; /* Lighter grey for secondary text */
            --text-muted: #9ca3af;
            --text-accent: #ffd700; /* Gold text for accents */
            --text-on-accent: #1a1a1a;
            --border-color: #4b5563;
            --message-user-bg: #ffd700;
            --message-user-text: #1a1a1a;
            --message-assistant-bg: #2a2a2a;
            --message-assistant-text: #f3f4f6;
            --message-system-bg: #2a2a2a;
            --message-system-text: #d1d5db;
            --code-bg: #2a2a2a;
            --thinking-bg: #2a2a2a;
            --thinking-border: #ffd700; /* Gold border */
            --button-hover: #ffcc00; /* Slightly darker gold for button hover */
            --shadow-color: rgba(0, 0, 0, 0.3);
        }
        
        /* Specific button styling for dark theme */
        [data-theme="dark"] .new-chat-button,
        [data-theme="dark"] .sidebar-button,
        [data-theme="dark"] .send-button,
        [data-theme="dark"] .file-upload-button,
        [data-theme="dark"] .title-action-button {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            border: none;
        }
        
        [data-theme="dark"] .new-chat-button:hover,
        [data-theme="dark"] .sidebar-button:hover,
        [data-theme="dark"] .send-button:hover,
        [data-theme="dark"] .file-upload-button:hover,
        [data-theme="dark"] .title-action-button:hover {
            background-color: var(--button-hover);
            transform: scale(1.05);
        }
        
        [data-theme="dark"] .header {
            background-color: var(--bg-secondary);
            border-bottom: 2px solid var(--text-accent); /* Gold accent line */
        }
        
        [data-theme="dark"] .chat-title,
        [data-theme="dark"] .chat-model,
        [data-theme="dark"] .model-select {
            color: var(--text-primary); /* Use bright white for better contrast */
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .header {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between; /* Keep space between left/center/right */
            align-items: center;
            box-shadow: 0 2px 4px var(--shadow-color);
            z-index: 10;
            transition: background-color 0.3s ease, color 0.3s ease;
            /* position: relative; No longer needed */
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0; /* Prevent shrinking */
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-shrink: 0; /* Prevent shrinking */
        }
        
        .chat-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* Align items to the start (left) */
            /* Remove absolute positioning and centering */
            margin-left: 3.5rem; /* Add some space from the sidebar toggle */
            flex-grow: 1; /* Allow it to take available space */
            min-width: 0; /* Allow shrinking if needed */
        }
        
        .chat-title-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .title-actions {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .chat-title {
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--text-on-accent);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .chat-model {
            font-size: 0.875rem;
            color: var(--text-on-accent);
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .title-action-button {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 0 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }
        
        .title-action-button:hover {
            background-color: var(--button-hover);
            transform: scale(1.1);
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
            margin-top: 0; /* Ensure no gap between header and content */
        }
        
        .sidebar {
            width: 280px;
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s ease;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 5; /* Higher z-index to appear above the chat panel */
            height: 100%;
        }
        
        .sidebar.sidebar-collapsed {
            transform: translateX(-100%);
        }
        
        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin-left: 280px;
            transition: margin-left 0.3s ease;
            width: calc(100% - 280px);
        }
        
        .chat-panel.sidebar-collapsed {
            margin-left: 0;
            width: 100%;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: flex-end;
            padding: 0.5rem;
        }
        
        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: transform 0.2s ease;
        }
        
        .sidebar-toggle:hover {
            transform: scale(1.1);
            color: var(--text-accent);
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-accent);
            margin: 0;
        }
        
        .sidebar-actions {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .new-chat-button, .sidebar-button {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            border: none;
            border-radius: 8px;
            width: 100%;
            padding: 10px 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 0; /* Remove gap and use margin on icons instead */
            margin-top: 10px;
            font-size: 14px;
            height: 42px;
        }
        
        /* First button doesn't need top margin */
        .new-chat-button {
            margin-top: 0;
        }
        
        .new-chat-button i, .sidebar-button i {
            font-size: 18px; /* Slightly larger icons */
            width: 30px; /* Wider fixed width for icon container */
            text-align: center;
            display: inline-block; /* Use inline-block instead of flex */
            margin-right: 12px; /* Consistent spacing */
        }
        
        /* Specific adjustments for each icon if needed */
        .new-chat-button i.fa-plus {
            font-size: 18px;
        }
        
        #manage-bots-button i.fa-robot {
            font-size: 18px;
        }
        
        /* Nudge the settings button content to the right */
        .preferences-button {
            padding-left: 25px; /* Increase left padding to move content right */
        }
        
        .preferences-button i.fa-cog {
             font-size: 18px;
            margin-left: 8px; /* Nudge the icon to the right */
        }
        
        .new-chat-button span, .sidebar-button span {
            flex: 1;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 14px; /* Ensure consistent font size */
        }
        
        .new-chat-button:hover, .sidebar-button:hover {
            background-color: var(--button-hover);
            transform: scale(1.05);
        }
        
        .conversation-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .conversation-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .conversation-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .conversation-item.active-conversation {
            background-color: rgba(255, 215, 0, 0.1);
            border-left: 3px solid #ffd700;
        }
        
        .conversation-title {
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .conversation-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: var(--text-muted);
        }
        
        .conversation-model {
            font-style: italic;
        }
        
        .conversation-date {
            margin-left: 10px;
        }
        
        .chat-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message-input-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            position: relative;
        }
        
        .message-input {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .message-input:focus {
            outline: none;
            border-color: var(--bg-accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        
        .file-upload-button {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            color: var(--text-secondary);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
        }
        
        .file-upload-button:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-accent);
            transform: scale(1.1);
        }
        
        .file-upload-button.uploading {
            background-color: var(--bg-tertiary);
            color: var(--text-accent);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
            100% {
                opacity: 1;
            }
        }
        
        .hidden-file-input {
            display: none;
        }
        
        .upload-status-indicator {
            position: absolute;
            bottom: -1.5rem;
            left: 1.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            max-width: 80%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .send-button {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .send-button:hover {
            background-color: var(--button-hover);
            transform: scale(1.05);
        }
        
        .user-message {
            align-self: flex-end;
            background-color: var(--message-user-bg);
            color: var(--message-user-text);
            border-radius: 1rem 1rem 0 1rem;
            padding: 0.75rem 1rem;
            max-width: 80%;
            box-shadow: 0 1px 2px var(--shadow-color);
        }
        
        .assistant-message {
            align-self: flex-start;
            background-color: var(--message-assistant-bg);
            color: var(--message-assistant-text);
            border-radius: 1rem 1rem 1rem 0;
            padding: 0.75rem 1rem;
            max-width: 80%;
            box-shadow: 0 1px 2px var(--shadow-color);
        }
        
        .system-message {
            align-self: center;
            background-color: var(--message-system-bg);
            color: var(--message-system-text);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            max-width: 80%;
            text-align: center;
        }
        
        .thinking {
            background-color: var(--thinking-bg);
            padding: 0.5rem 1rem;
            border-left: 3px solid var(--thinking-border);
            border-radius: 0.25rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            overflow-x: auto;
        }
        
        details summary {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            padding: 0.5rem 0;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        details summary::before {
            content: '▶';
            margin-right: 0.5rem;
            transition: transform 0.2s;
            font-size: 0.75rem;
        }
        
        details[open] summary::before {
            transform: rotate(90deg);
        }
        
        .main-response {
            margin-top: 0.75rem;
        }
        
        code {
            background-color: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            font-size: 0.875em;
        }
        
        .model-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .model-select {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 0.375rem;
            padding: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            min-width: 150px;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .model-select:focus {
            outline: none;
            border-color: var(--bg-accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        
        .refresh-button {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: var(--text-accent);
            border-radius: 0.375rem;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out, background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .refresh-button:hover {
            background-color: var(--bg-tertiary);
            transform: rotate(180deg);
        }
        
        .theme-toggle-button, .preferences-button {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .theme-toggle-button:hover, .preferences-button:hover {
            transform: scale(1.1);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 4px;
            color: white;
            font-weight: 500;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
        }
        
        .notification.success {
            background-color: #10b981;
        }
        
        .notification.error {
            background-color: #ef4444;
        }
        
        .notification.info {
            background-color: #3b82f6;
        }
        
        .sidebar-toggle {
            background-color: transparent;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toggle-icon {
            max-width: 280px; /* Match the sidebar width */
            max-height: 60px;
            width: auto;
            height: auto;
            object-fit: contain;
            transition: all 0.3s ease;
        }
        
        /* Modal styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(2px);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            padding: 1.5rem;
            border-radius: 0.5rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        
        .preferences-modal-content {
            max-width: 600px;
        }
        
        .modal h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        
        .preferences-tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
            opacity: 0.7;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .tab-button.active {
            opacity: 1;
            border-bottom: 2px solid var(--text-accent);
        }
        
        .preference-group {
            margin-bottom: 1.5rem;
        }
        
        .preference-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .preference-select {
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .preference-description {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }
        
        .checkbox-group {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        
        .checkbox-group label {
            display: block;
            padding: 0.25rem 0;
            font-weight: normal;
        }
        
        .radio-group {
            display: flex;
            gap: 1rem;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: normal;
        }
        
        .checkbox-option {
            margin-top: 0.5rem;
        }
        
        .checkbox-option label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: normal;
            cursor: pointer;
        }
        
        .checkbox-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        /* Conversations Modal */
        .conversations-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .conversations-modal-content {
            background-color: var(--bg-primary);
            padding: 25px;
            border-radius: 10px;
            width: 85%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .conversations-modal h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .all-conversations-list {
            display: grid;
            gap: 12px;
        }
        
        .conversations-modal .conversation-item {
            padding: 15px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            transition: transform 0.2s, background-color 0.2s;
            color: white;
        }
        
        .conversations-modal .conversation-item:hover {
            background-color: var(--bg-tertiary);
            transform: translateY(-2px);
        }
        
        .conversations-modal .conversation-title {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 6px;
            color: white;
        }
        
        .conversations-modal .conversation-meta {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .conversations-modal .conversation-model {
            font-style: italic;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .conversations-modal .conversation-date {
            margin-left: 10px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
        }
        
        .more-conversations-button {
            padding: 10px;
            text-align: center;
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        .more-conversations-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Empty state styling */
        .empty-message {
            color: var(--text-muted);
            text-align: center;
            padding: 1rem;
            font-size: 0.875rem;
        }
        
        /* Delete Confirmation Modal */
        .danger-button {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .danger-button:hover {
            background-color: var(--button-hover);
            transform: scale(1.05);
        }
        
        .secondary-button {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .secondary-button:hover {
            background-color: var(--bg-tertiary);
            transform: scale(1.05);
        }
        
        .active-conversation {
            background-color: rgba(255, 215, 0, 0.1);
            border-left: 3px solid #ffd700;
        }
        
        .conversation-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        /* Conversation Buttons */
        .conversation-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .conversation-item:hover .conversation-buttons {
            opacity: 1;
        }
        
        .rename-conversation-button,
        .delete-conversation-button {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            font-size: 0.9em;
            border-radius: 4px;
        }
        
        .rename-conversation-button:hover {
            color: var(--text-primary);
            background: rgba(255,255,255,0.1);
        }
        
        .delete-conversation-button:hover {
            color: #ff6b6b;
            background: rgba(255,107,107,0.1);
        }
        
        /* Loading Animation */
        .loading-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            display: none;
            text-align: center;
        }
        
        .loading-message {
            color: white;
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        .loading-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            animation: float 3s ease-in-out infinite;
        }
        
        .loading-pulse {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 255, 255, 0.2);
            top: 0;
            left: 0;
            animation: pulse 2s infinite;
            z-index: -1;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        @keyframes pulse {
            0% { transform: scale(0.9); opacity: 0.7; }
            70% { transform: scale(1.3); opacity: 0; }
            100% { transform: scale(0.9); opacity: 0; }
        }
        
        /* Chat Card Update Animation */
        .conversation-item.updated {
            animation: bump 0.5s ease;
        }
        
        @keyframes bump {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        /* Message Action Buttons Styling */
        .user-message, .assistant-message {
            position: relative; /* Needed for absolute positioning of actions */
            overflow: visible; /* Ensure buttons aren't clipped */
        }

        .message-actions {
            position: absolute;
            bottom: 5px; /* Position near the bottom */
            right: 8px;  /* Position near the right */
            /* transform: translateY(-50%); Remove vertical centering */
            display: flex;
            gap: 4px;
            background-color: var(--bg-secondary); /* Use theme background */
            padding: 4px 8px;
            border-radius: 15px; /* Pill shape */
            box-shadow: 0 1px 3px var(--shadow-color);
            opacity: 0; /* Hidden by default */
            transition: opacity 0.2s ease-in-out;
            z-index: 1; /* Ensure buttons are above message content */
        }

        /* Comment for user message actions */
        /* .user-message .message-actions {
            left: -10px; 
            right: auto;
        } */

        .user-message:hover .message-actions,
        .assistant-message:hover .message-actions {
            opacity: 1; /* Show on hover */
        }

        .message-actions button {
            background: none;
            border: none;
            color: var(--text-muted); /* Use muted text color */
            cursor: pointer;
            padding: 2px;
            font-size: 0.8em; /* Smaller icons */
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message-actions button:hover {
            color: var(--text-primary); /* Darker color on hover */
        }

        .message-actions button .fa-check {
             color: #22c55e; /* Green check for copy success */
        }

        /* Notification Styling */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px); /* Start hidden above */
            padding: 10px 20px;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1001; /* Above modals */
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            color: #fff; /* Default text color */
        }

        .notification-info {
            background-color: #3b82f6; /* Blue */
        }

        .notification-success {
            background-color: #22c55e; /* Green */
        }

        .notification-error {
            background-color: #ef4444; /* Red */
        }
        
        .file-upload-button {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .file-upload-button:hover {
            background-color: var(--button-hover);
            transform: scale(1.05);
        }
        
        .hidden-file-input {
            display: none;
        }
        
        .upload-status-indicator {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Attachment Preview Styles */
        #attachment-preview {
            display: none; /* Hidden by default */
            background-color: var(--bg-secondary);
            border-radius: 4px;
            font-size: 0.85em;
            padding: 2px 6px;
            margin: 0 5px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            max-width: 150px; /* Limit width to prevent overflow */
        }

        #attachment-preview span {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            margin-right: 5px;
        }

        .remove-attachment {
            cursor: pointer;
            font-weight: bold;
            color: var(--text-error);
            font-size: 1.2em;
            line-height: 1;
        }

        .remove-attachment:hover {
            color: darkred;
        }
        
        .message-input-wrapper {
            display: flex;
            align-items: center;
            flex-grow: 1;
            background-color: var(--bg-primary);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            padding: 0 8px;
        }

        .message-input-wrapper textarea {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 6px;
            background-color: transparent;
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.3s ease;
            width: 100%;
        }
        
        .message-input-wrapper textarea:focus {
            outline: none;
            border-color: var(--bg-accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        
        /* Message Attachment Styles */
        .message-attachment {
            background-color: var(--bg-secondary);
            padding: 5px 10px;
            margin-top: 8px;
            border-radius: 4px;
            font-size: 0.85em;
            color: var(--text-secondary);
            display: block; /* Changed to block for better positioning */
            max-width: 100%; /* Allow it to take full width of its container */
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        
        /* Adjust attachment style for user messages */
        .user-message .message-attachment {
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--message-user-text);
            margin-left: auto; /* Auto margin on left for right alignment */
            margin-right: 0;
            max-width: 80%; /* Limit width for better appearance */
        }
        
        .message-content {
            white-space: pre-wrap; /* Ensures line breaks are respected */
        }
        
        /* Loading animation for preferences modal */
        .preferences-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }
        
        .preferences-loading img {
            width: 80px;
            height: auto; /* Changed from fixed height to auto to maintain aspect ratio */
            animation: float 2s ease-in-out infinite;
        }
        
        .preferences-loading p {
            margin-top: 1rem;
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
            100% {
                transform: translateY(0px);
            }
        }
        
        .preferences-loading .error-message {
            color: #e53e3e;
            margin-bottom: 1rem;
        }
        
        .preferences-loading .retry-button {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .preferences-loading .retry-button:hover {
            background-color: var(--button-hover);
            transform: scale(1.05);
        }
        
        /* Bot Management Modal */
        #bot-management-modal .modal-content {
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }
        
        #bot-management-modal .modal-header {
            border-bottom: 1px solid var(--border-color);
            border-radius: 12px 12px 0 0;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        #bot-management-modal .header-left {
            display: flex;
            align-items: center;
        }
        
        #bot-management-modal .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #bot-management-modal .modal-header h2 {
            color: var(--text-primary);
            margin: 0;
            font-size: 1.3rem;
            font-weight: 500;
        }
        
        #bot-management-modal .close-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
            margin-left: 10px;
        }
        
        #bot-management-modal .modal-body {
            max-height: calc(90vh - 120px);
            overflow-y: auto;
            padding: 20px;
        }
        
        #bot-management-modal .bot-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
            padding-right: 10px;
        }
        
        #bot-management-modal .bot-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border-color);
        }
        
        #bot-management-modal .bot-item:hover {
            background-color: var(--bg-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        #bot-management-modal .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        #bot-management-modal .section-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.2rem;
        }
        
        #bot-management-modal .form-group {
            margin-bottom: 15px;
            width: 100%;
        }
        
        #bot-management-modal .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        #bot-management-modal .form-group input,
        #bot-management-modal .form-group select,
        #bot-management-modal .form-group textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        #bot-management-modal .form-group input:focus,
        #bot-management-modal .form-group select:focus,
        #bot-management-modal .form-group textarea:focus {
            border-color: var(--bg-accent);
            outline: none;
            box-shadow: 0 0 0 2px rgba(var(--accent-rgb), 0.2);
        }
        
        #bot-management-modal .knowledge-files-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
            max-height: 120px;
            overflow-y: auto;
            padding: 10px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
        }
        
        #bot-management-modal .parameters-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
        }
        
        #bot-management-modal .primary-button, #bot-management-modal .secondary-button {
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }
        
        #bot-management-modal .primary-button {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
        }
        
        #bot-management-modal .primary-button:hover {
            background-color: var(--button-hover);
            transform: translateY(-1px);
        }
        
        #bot-management-modal .secondary-button {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        #bot-management-modal .secondary-button:hover {
            background-color: var(--bg-hover);
            transform: translateY(-1px);
        }
        
        #bot-management-modal .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            text-align: center;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            border: 1px dashed var(--border-color);
        }
        
        #bot-management-modal .bot-info {
            flex: 1;
        }
        
        #bot-management-modal .bot-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        #bot-management-modal .bot-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        #bot-management-modal .bot-model {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        #bot-management-modal .bot-actions {
            display: flex;
            gap: 8px;
        }
        
        #bot-management-modal .bot-actions button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        #bot-management-modal .bot-actions button:hover {
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
        }
        
        #bot-management-modal .bot-form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
            max-width: 100%;
        }
        
        #bot-management-modal .bot-form-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 100%;
        }
        
        #bot-management-modal .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        #bot-management-modal #bot-system-prompt {
            min-height: 100px;
        }
        
        #bot-management-modal .knowledge-base-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        #bot-management-modal .file-upload-container {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            box-sizing: border-box;
        }
        
        #bot-management-modal .file-upload-container input[type="file"] {
            display: none;
        }
        
        #bot-management-modal .knowledge-file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
            background-color: var(--bg-primary);
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        
        #bot-management-modal .knowledge-file-name {
            font-size: 0.9rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 80%;
        }
        
        #bot-management-modal .knowledge-file-remove {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 4px;
        }
        
        #bot-management-modal .knowledge-file-remove:hover {
            color: #e53e3e;
        }
        
        #bot-management-modal .parameter-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #bot-management-modal .parameter-row label {
            min-width: 100px;
            margin: 0;
        }
        
        #bot-management-modal .parameter-row input[type="range"] {
            flex: 1;
        }
        
        #bot-management-modal .parameter-row span {
            min-width: 40px;
            text-align: right;
        }
        
        #bot-management-modal .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            grid-column: span 2;
        }
        
        #bot-management-modal .error-state {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
        }
        
        #bot-management-modal .retry-button {
            margin-top: 10px;
            background-color: var(--bg-accent);
            color: var(--text-on-accent);
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
        }
        
        #bot-management-modal .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
        }
        
        #bot-management-modal .loading-container img {
            width: 60px;
            height: auto;
            animation: float 2s ease-in-out infinite;
        }
        
        #bot-management-modal .loading-container p {
            margin-top: 15px;
            color: var(--text-secondary);
        }
        
        /* Tooltip Styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            max-width: 250px;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            text-align: center;
            border-radius: 6px;
            padding: 8px 12px;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            width: 250px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 0.85rem;
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .parameter-row .tooltip label {
            margin-right: 8px;
            cursor: help;
        }
        
        /* Add positioning classes for different tooltip placements */
        .tooltip-right .tooltip-text {
            left: 0;
            transform: translateX(0);
        }
        
        .form-group .tooltip {
            display: block;
            max-width: 100%;
        }
        
        .sidebar-button.secret-active {
            background-color: #222a3a !important;
            color: #ffd700 !important;
            border: 2px solid #ffd700 !important;
            box-shadow: 0 0 8px #ffd70044;
            transform: scale(1.05);
        }
        
        /* Fading into ashes animation */
        @keyframes fadeToAshes {
            0% {
                opacity: 1;
                filter: grayscale(0%) blur(0px);
                transform: scale(1) translateY(0);
            }
            60% {
                opacity: 0.6;
                filter: grayscale(80%) blur(1px);
                transform: scale(0.98) translateY(-6px);
            }
            80% {
                opacity: 0.2;
                filter: grayscale(100%) blur(3px);
                transform: scale(0.96) translateY(-12px);
            }
            100% {
                opacity: 0;
                filter: grayscale(100%) blur(6px);
                transform: scale(0.95) translateY(-20px);
            }
        }
        .fade-to-ashes {
            animation: fadeToAshes 1.1s forwards;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-left">
                <button id="sidebar-toggle" class="sidebar-toggle" title="Toggle Sidebar">
                    <img id="sidebar-toggle-icon" src="/static/assets/bigxeno.png" alt="Toggle Sidebar" class="toggle-icon">
                </button>
            </div>
            
            <div class="chat-info">
                <div class="chat-title-container">
                    <h2 id="chat-title" class="chat-title">New Chat</h2>
                    <div class="title-actions">
                        <button id="edit-title-button" class="title-action-button" title="Edit Title">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button id="delete-conversation-button" class="title-action-button" title="Delete Conversation">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div id="chat-model" class="chat-model">Select a model</div>
            </div>
            
            <div class="header-controls">
                <div class="model-selector">
                    <select id="model-select" class="model-select">
                        <option value="" disabled selected>Loading models...</option>
                    </select>
                    <button id="refresh-models" class="refresh-button">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="sidebar-header">
                </div>
                <div class="sidebar-actions">
                    <button id="new-chat-button" class="new-chat-button">
                        <i class="fas fa-plus"></i>
                        <span>New Chat</span>
                    </button>
                    <button id="toggle-secret-chat" class="sidebar-button" onclick="toggleSecretChatMode()">
                        <i class="fas fa-user-secret"></i>
                        <span>Secret Chat</span>
                    </button>
                    <button id="manage-bots-button" class="sidebar-button">
                        <i class="fas fa-robot"></i>
                        <span>Manage Bots</span>
                    </button>
                    <button id="preferences-button" class="sidebar-button preferences-button">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                </div>
                <div id="conversation-list" class="conversation-list">
                    <!-- Conversation items will be added here -->
                </div>
            </div>
            
            <div class="chat-panel">
                <div id="chat-container" class="chat-container">
                    <!-- Chat messages will appear here -->
                    <div class="system-message">
                        Welcome to MIDAS3.0. Select a model and start chatting!
                    </div>
                </div>
                
                <div class="message-input-container">
                    <div id="upload-status" class="upload-status-indicator"></div>
                    <button id="file-upload-button" class="file-upload-button" title="Attach document">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <input type="file" id="doc-upload-input" name="document" accept=".txt,.pdf,.md" class="hidden-file-input" />
                    <div class="message-input-wrapper">
                        <textarea id="message-input" 
                               class="message-input" 
                               placeholder="Type your message..."></textarea>
                        <div id="attachment-preview">
                            <span></span> <!-- Filename will go here -->
                            <span class="remove-attachment" title="Remove attachment">&times;</span>
                        </div>
                    </div>
                    <button id="send-button" class="send-button">
                        <span>Send</span>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Loading Animation -->
        <div id="loading-animation" class="loading-animation">
            <img src="/static/assets/xeno.png" alt="Loading" class="loading-image">
            <div class="loading-pulse"></div>
        </div>
        
        <!-- Delete Confirmation Modal -->
        <div id="delete-confirm-modal" class="modal">
            <div class="modal-content">
                <h3>Delete Conversation</h3>
                <p>Are you sure you want to delete this conversation?</p>
                <div class="modal-actions">
                    <button id="confirm-delete" class="danger-button">Delete</button>
                    <button id="cancel-delete" class="secondary-button">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Preferences Modal -->
        <div id="preferences-modal" class="modal">
            <div class="modal-content preferences-modal-content">
                <h3>Settings</h3>
                <div class="preferences-tabs">
                    <button class="tab-button active" data-tab="models">Models</button>
                    <button class="tab-button" data-tab="appearance">Appearance</button>
                </div>
                
                <!-- Loading animation for preferences -->
                <div id="preferences-loading" class="preferences-loading">
                    <img src="/static/assets/xeno.png" alt="Loading preferences">
                    <p>Loading preferences...</p>
                </div>
                
                <div class="tab-content" id="models-tab">
                    <div class="preference-group">
                        <label for="default-model">Default Chat Model</label>
                        <select id="default-model" class="preference-select">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                        <p class="preference-description">Model used for new conversations</p>
                    </div>
                    
                    <div class="preference-group">
                        <label for="default-embedding-model">Default Embedding Model</label>
                        <select id="default-embedding-model" class="preference-select">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                        <p class="preference-description">Used for RAG document indexing</p>
                    </div>
                    
                    <div class="preference-group">
                        <label>Visible Models</label>
                        <div id="visible-models-container" class="checkbox-group">
                            <!-- Checkboxes will be populated by JavaScript -->
                        </div>
                        <p class="preference-description">Control which models appear in the dropdown</p>
                    </div>
                </div>
                <div class="tab-content" id="appearance-tab" style="display: none;">
                    <div class="preference-group">
                        <label>Theme</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="theme" value="light">
                                Light
                            </label>
                            <label>
                                <input type="radio" name="theme" value="dark">
                                Dark
                            </label>
                            <label>
                                <input type="radio" name="theme" value="system">
                                System (auto)
                            </label>
                        </div>
                    </div>
                    
                    <div class="preference-group">
                        <label>Thinking Process</label>
                        <div class="checkbox-option">
                            <label>
                                <input type="checkbox" id="show-thinking" name="show-thinking">
                                Show thinking process by default
                            </label>
                            <p class="preference-description">When enabled, the model's thinking process will be automatically expanded in responses</p>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="save-preferences" class="primary-button">Save</button>
                    <button id="cancel-preferences" class="secondary-button">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Bot Management Modal -->
        <div id="bot-management-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="header-left">
                        <h2 id="bot-modal-title">Bot Management</h2>
                    </div>
                    <div class="header-right">
                        <button id="create-new-bot-button" class="primary-button">Create New Bot</button>
                        <button id="back-to-bot-list-button" class="secondary-button" style="display: none;">Back to List</button>
                        <button class="close-button" id="close-bot-modal">&times;</button>
                    </div>
                </div>
                
                <div class="modal-body">
                    <!-- Bot List Section -->
                    <div id="bot-list-section">
                        <div id="bot-list-container" class="bot-list">
                            <!-- Bot items will be added here dynamically -->
                            <div class="loading-container">
                                <img src="/static/assets/xeno.png" alt="Loading" class="loading-spinner">
                                <p>Loading bots...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot Editor Section (initially hidden) -->
                    <div id="bot-editor-section" style="display: none;">
                        <form id="bot-form">
                            <input type="hidden" id="bot-id" value="">
                            
                            <div class="bot-form-container">
                                <div class="bot-form-column">
                                    <div class="form-group">
                                        <label for="bot-name">Bot Name</label>
                                        <input type="text" id="bot-name" placeholder="Enter a name for your bot" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="bot-description">Description</label>
                                        <textarea id="bot-description" placeholder="Describe what this bot does" rows="2"></textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="bot-greeting">Greeting Message</label>
                                        <textarea id="bot-greeting" placeholder="Message to display when a user starts a chat with this bot" rows="2"></textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="tooltip tooltip-right">
                                            <label for="bot-base-model">Base Model</label>
                                            <span class="tooltip-text">Select the primary language model for generating responses. Different models have varying capabilities, strengths, and response styles.</span>
                                        </div>
                                        <select id="bot-base-model" required>
                                            <!-- Will be populated dynamically -->
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="tooltip tooltip-right">
                                            <label for="bot-embedding-model">Embedding Model</label>
                                            <span class="tooltip-text">Choose the model used for converting text into numerical representations. This affects the quality of semantic search and knowledge retrieval.</span>
                                        </div>
                                        <select id="bot-embedding-model" required>
                                            <!-- Will be populated dynamically -->
                                        </select>
                                    </div>
                                </div>
                                <div class="bot-form-column">
                                    <div class="form-group">
                                        <label for="bot-system-prompt">System Prompt</label>
                                        <textarea id="bot-system-prompt" placeholder="Instructions for the bot's behavior" rows="5"></textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>Knowledge Base</label>
                                        <div class="knowledge-base-selector">
                                            <div class="file-upload-container">
                                                <input type="file" id="knowledge-file-input" multiple accept=".txt,.pdf,.docx,.md">
                                                <button type="button" id="upload-knowledge-button" class="secondary-button">Upload Files</button>
                                            </div>
                                            <div id="knowledge-files-list" class="knowledge-files-list">
                                                <!-- Knowledge files will be listed here -->
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>Model Parameters</label>
                                        <div class="parameters-container">
                                            <div class="parameter-row">
                                                <div class="tooltip">
                                                    <label for="bot-temperature">Temperature</label>
                                                    <span class="tooltip-text">Controls the randomness of the model's responses. Higher values (0.8-2.0) make output more creative and diverse, while lower values (0.0-0.2) make it more focused and deterministic.</span>
                                                </div>
                                                <input type="range" id="bot-temperature" min="0" max="2" step="0.1" value="0.7">
                                                <span id="temperature-value">0.7</span>
                                            </div>
                                            
                                            <div class="parameter-row">
                                                <div class="tooltip">
                                                    <label for="bot-top-p">Top P</label>
                                                    <span class="tooltip-text">Nucleus sampling parameter that controls the model's token selection. Lower values (0.1-0.3) make responses more precise, while higher values (0.7-1.0) allow more diverse token choices.</span>
                                                </div>
                                                <input type="range" id="bot-top-p" min="0" max="1" step="0.05" value="0.9">
                                                <span id="top-p-value">0.9</span>
                                            </div>
                                            
                                            <div class="parameter-row">
                                                <div class="tooltip">
                                                    <label for="bot-max-tokens">Max Tokens</label>
                                                    <span class="tooltip-text">Maximum number of tokens the model can generate in a single response. Higher values allow longer responses, while lower values keep responses concise.</span>
                                                </div>
                                                <input type="number" id="bot-max-tokens" min="100" max="4096" value="2048">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" id="save-bot-button" class="primary-button">Save Bot</button>
                                    <button type="button" id="cancel-bot-edit" class="secondary-button">Cancel</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading animation for preferences -->
        <div id="loading-animation" class="loading-animation">
            <img src="/static/assets/xeno.png" alt="Loading" class="loading-image">
            <div class="loading-pulse"></div>
        </div>
        
        <!-- Template for chat messages -->
        <template id="message-template">
            <div class="message">
                <div class="message-sender"></div>
                <div class="message-content"></div>
                <div class="message-attachment" style="display: none;"></div> <!-- Hidden by default -->
                <div class="message-thinking" style="display: none;">Thinking...</div>
                <div class="message-images"></div>
            </div>
        </template>
    </div>

    <script src="static/js/main.js"></script>
</body>
</html>
